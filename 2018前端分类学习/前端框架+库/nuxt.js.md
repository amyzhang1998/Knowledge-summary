# nuxt 服务端渲染

## ssr 是什么？ssr 是怎么解决问题的？

## ssr 方案

- 开发分离发布合并。为搜索引擎和真实用户准备两套呈现逻辑，通过 HTML5 History 实现资源的统一，通过 noscript 分流机器和人，缺点是页面不能有复杂的交互，因为缺少数据和页面事件的处理机制。

## ssr 目的：

https://juejin.im/entry/5b02775d6fb9a07aa632117f
解决 SEO 问题：纯前端的项目，由于需要页面加载完成后再去拉取数据进行渲染，大部分搜索引擎没法读取页面内容。特别是 SPA 项目，更是无法读取到每个路由页面的页面 Tite。
首屏渲染速度：纯前端项目，先要加载 Js，再通过 Js 去加载数据，这两部分网络传输都需要时间，所以难以避免出现页面白屏时间，体验不友好。

## ssr 带来的挑战

多维护一层 server：要用 SSR，你就得准备一个 node server（express，koa...），这就不可避免地加大了性能、运维等挑战。
代码兼容：浏览器里的好多代码在 server side render 过程中是会报错的，所以你得花很多精力去处理其中的兼容性。
技术限制：虽然现在 Vue、React 等流行框架都出台了相应的 SSR 解决方案，但如果你不用这些框架怎么呢，自己撸一套？还有就算用这些解决方案，难免也有些限制让人束手束脚，踩坑不可避免。

## 怎么提供支持 ssr 的三方包或者是组件

## 谈一下如何在没有条件使用 SSR 的时候如何解决问题。

部署一个独立的 prerender 的 server（上面贴出来的，现成的只需要配置、部署一下）。
在你的前端项目的 nginx 上加一段配置，通过 useragent 检测，如果是爬虫，就将地址代理到这个 server，这个 server 会将页面渲染好了返回给爬虫。如果前端项目是通过 express 渲染，也有 prerender 相应的中间件代理到这个 server。

## ssr 首屏渲染

其实很简单，这就是所谓的数据直出：

用 koa 写一个 node server
server 创建一个路由做两件事：把页面返回给浏览器、把页面对应的初始化 JSON 数据放在页面上一起返回。
页面直接用 JSON 数据渲染。
不错，上面这种方法解决了因为后加载数据引起的页面白屏问题。但还有个问题，上面数据直出的方式有个缺点，那就是页面一开始没有 title 和 图片，可能微信分享等有时会出现抓不到标题图片等问题。

如果要解决这个问题，那就还得累一累，多做一步工作了：

server 路由返回页面内容的时候把标题等也渲染好一起返回。
注：server 端路由返回页面时可以用一些和前端框架（vue 等）兼容的简单模板引擎（用来渲染 title 和初始化 JSON 等...），比如 ejs（ejs 标签返回给前端后就没有了，不影响 vue 使用）。

## nuxt 内存泄露

## asyncData 是在编译时加载，还是 请求 时加载？

## nuxt 部署。

## nuxt 引起的内存溢出

## nuxt 的自定义路由跳转，为什么不会每次都走 asyncData

## 提速

## 缓存的原理

## nuxt 区分环境变量，在 production 下会自动构建（Builder）,研究 builder 原理

## 缺点

1.  不能 异步按需加载
2.  目录结构不可变
3.  解决了 dev 环境，但是没能整合 sever 端，你用 nuxt 开发完，还得继续选择 express 或者 koa 等，来配置线上环境
4.  前后端分离，需要前端存储 token 及登录后的用户信息
5.  vuex 存储数据，当页面 刷新时，数据会丢失
6.  鉴于第一点，采用 localstorage 或 sessionStorage 存储数据，页面刷新，数据不会丢失，BUT，localStorage or sessionStorage 是浏览器的对象，服务端渲染页面时，会提示 undefined（毕竟服务器是没有这两个对象的）；
    解决措施： 采用 session (本来采用的是 express-session，但此模块为开发环境设计，在生产环境会警告可能内存泄漏，故采用 cookie-session）

## 坑

publicpath，多语言

## nuxt2 出来 了 体验版 nuxt-adge

## 其他网站

使用 vue seo 的高流量 网站，
http://www.bilibili.com
（1）TDK 描叙详细。
（2）提升网页加载速度：对外联 css,以及 js 使用了延迟加载以及 dns-prefetch，preload。
（3）外联较多，关键词排名高。
2） 掘金网站使用了 vue-meta-info 管理网站的 meta，应该配合使用了 prerender-spa-plugin 对 SEO 进行了优化。
3） Element 在 logo 上加了首页的地址，并且只有 logo 是放在 h1 标签中。
http://www.cdxtjy.com/swzpmrj/58.html seo 分析 方法

## 分析 内存泄露的方法

###. 定位原因

1.  出现大量的引用循环对象
2.  随着时间过去，问题复现。就可能是定时器上下文问题
3.  随着请求的堆积，问题复现。

4.  某些 dom 操作
5.  自动类型装箱转换
6.  定时器泄漏

###. 泄漏出现概率
业务代码 > 除框架外的三方代码（比如同事或其他团队写的代码） > 框架代码 > Node 本身问题

###. 方法

针对 1 原因，node 执行 gc ,如果内存恢复很多 ，就是存在大量循环引用。

### 工具
